<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Futaba Telemetry Grapher</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="app-shell">
    <aside class="sidebar no-print">
      <h1>Futaba Grapher</h1>
      <p class="muted">CSV local, analyses et graphiques imprimables.</p>

      <section class="panel">
        <h2>Import</h2>
        <div id="dropZone" class="drop-zone">
          <p>Glisser-déposer un CSV ici</p>
          <button id="pickFileBtn" type="button">Choisir un fichier</button>
          <input id="csvInput" type="file" accept=".csv,text/csv" hidden>
          <button id="loadSampleBtn" type="button" class="ghost">Charger l'exemple</button>
        </div>
        <p id="fileMeta" class="muted"></p>
        <p id="errorBox" class="error" hidden></p>
      </section>

      <section class="panel">
        <div class="panel-head">
          <h2>Paramètres</h2>
          <span class="settings-legend">(★ Import auto)</span>
        </div>
        <div class="settings-toolbar">
          <input id="settingNameInput" type="text" placeholder="Nom du réglage" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" data-lpignore="true" data-1p-ignore="true" data-form-type="other">
          <div class="btn-row settings-actions">
            <button id="settingNewBtn" type="button" class="ghost" title="Nouveau réglage">
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              <span>Nouveau</span>
            </button>
            <button id="settingUpdateBtn" type="button" title="Mettre à jour">
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M5 4h11l3 3v13H5z" stroke="currentColor" stroke-width="2" fill="none" stroke-linejoin="round"/>
                <path d="M8 4v6h6V4" stroke="currentColor" stroke-width="2" fill="none" stroke-linejoin="round"/>
                <path d="M8 14h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              <span>Mettre à jour</span>
            </button>
            <button id="settingDeleteBtn" type="button" class="ghost" title="Supprimer">
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M6 7h12M9 7V5h6v2M8 7l1 12h6l1-12" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
              </svg>
              <span>Supprimer</span>
            </button>
          </div>
        </div>
        <input id="settingsImportInput" type="file" accept=".json,application/json" hidden>
        <div id="settingsList" class="settings-list" role="listbox" aria-label="Réglages"></div>
        <div class="btn-row settings-io">
          <button id="settingExportBtn" type="button">Exporter JSON</button>
          <button id="settingImportBtn" type="button" class="ghost">Importer JSON</button>
        </div>
      </section>

      <section class="panel">
        <h2>Affichage</h2>
        <label class="ratio-field">Format standard
          <select id="ratioPreset">
            <option value="16:9">16:9 (large)</option>
            <option value="4:3">4:3 (classique)</option>
            <option value="3:2">3:2</option>
            <option value="5:4">5:4</option>
            <option value="1:1">1:1 (carré)</option>
            <option value="21:9">21:9 (ciné)</option>
            <option value="9:16">9:16 (portrait)</option>
            <option value="custom">Personnalisé</option>
          </select>
        </label>
        <div id="ratioCustomWrap" class="ratio-custom">
          <label class="ratio-field">Ratio largeur / hauteur
            <div class="ratio-inputs">
              <input id="ratioWidth" type="number" min="1" max="100" step="1">
              <span>:</span>
              <input id="ratioHeight" type="number" min="1" max="100" step="1">
            </div>
          </label>
        </div>
      </section>

      <section class="panel no-print">
        <h2>Impression</h2>
        <div class="btn-row print-controls">
          <label class="print-orientation-field">Orientation
            <select id="printOrientation">
              <option value="portrait">Portrait</option>
              <option value="landscape">Paysage</option>
            </select>
          </label>
          <button id="printBtn" type="button" class="print-btn">Imprimer</button>
        </div>
      </section>
    </aside>

    <main class="main">
      <div class="main-inner">
        <header class="page-header print-only">
          <div class="page-header-left">
            <h1 class="page-title">Futaba Grapher</h1>
            <div class="page-credit">Made by Jérôme LEGO</div>
          </div>
          <div id="pageDate" class="page-date"></div>
        </header>
      <section class="panel no-print">
        <div class="summary-head">
          <h2>Résumé CSV</h2>
          <div class="summary-right">
            <div id="summaryGrid" class="summary-grid"></div>
            <button id="openColumnSettingsBtn" type="button" class="ghost">Colonnes & légendes</button>
          </div>
        </div>
        <div class="table-wrap">
          <table id="previewTable"></table>
        </div>
        <div id="previewToggleWrap" class="preview-toggle">
          <button id="previewToggleBtn" type="button" class="ghost">Voir plus</button>
        </div>
      </section>
        <section class="print-note">
          <label class="print-note-label" for="printNoteInput">Note</label>
          <textarea id="printNoteInput" class="print-note-input" rows="3" placeholder="Informations complémentaires sur la session..."></textarea>
          <div id="printNoteOutput" class="print-note-output"></div>
        </section>

        <section id="chartsContainer" class="charts"></section>
      </div>
    </main>
  </div>

  <div id="columnSettingsOverlay" class="overlay hidden no-print" aria-hidden="true">
    <div class="overlay-backdrop" data-overlay-close="true"></div>
    <section class="overlay-panel" role="dialog" aria-modal="true" aria-label="Réglages colonnes et légendes">
      <div class="overlay-head">
        <h2>Colonnes & légendes</h2>
        <button id="closeColumnSettingsBtn" type="button" class="ghost">Fermer</button>
      </div>
      <p class="muted">Nom affiché + unité utilisées pour les courbes.</p>
      <label class="inline column-filter-toggle">
        <input id="hideNullColumnsToggle" type="checkbox">
        Masquer les colonnes vides (0 ou vide)
      </label>
      <div id="columnSettingsList" class="column-settings-list"></div>
    </section>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.1/dist/echarts.min.js"></script>
  <script type="module" src="./js/app.js"></script>
</body>
</html>
